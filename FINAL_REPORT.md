# ðŸš“ SafeRoute Police Portal - Final System Report

## ðŸŸ¢ System Status
| Component | Status | Port | Description |
| :--- | :--- | :--- | :--- |
| **Frontend** | **Running** | `5173` | React + Vite Dashboard interface. Accessible at [http://localhost:5173](http://localhost:5173) |
| **Backend** | **Running** | `8000` | FastAPI server handling routes & risk logic. Accessible at [http://localhost:8000/docs](http://localhost:8000/docs) |
| **Database** | **Connected** | Cloud | Google Firestore (Real-time updates). |

---

## ðŸ— Project Structure & Configuration

### 1. File Organization
The project has been reorganized for better local development stability:
- **Frontend**: `c:\police portal\police-portal-app` (Vite + React)
- **Backend**: `c:\police portal\backend` (FastAPI + Python Scripts)
  - _Previously located in `c:\digipol\...`, now self-contained in the workspace._
- **Scripts**: Root level python scripts (e.g., `check_all_docs.py`) now point to the local `backend/serviceAccountKey.json`.

### 2. Verified Workflows
- **Startup**: 
  - Backend: `cd backend && python main.py`
  - Frontend: `cd police-portal-app && npm run dev`
- **Data Integrity**: 
  - `check_all_docs.py` successfully connects to Firestore using local credentials.
  - Risk zones and SOS logs are being fetched correctly.

---

## ðŸ”„ System Workflow

### 1. Data Ingestion (Backend & Mobile App)
- **Mobile App / Sources**: Users trigger SOS alerts or report incidents.
- **Backend API (`main.py`)**: 
  - Receives `POST /api/sos` requests.
  - Logs data into Firestore `emergency_logs` collection.
  - Calculates safe routes via `POST /safe-route` using the Risk Engine.

### 2. Data Storage (Firebase Firestore)
- **`emergency_logs`**: Stores real-time SOS alerts with status (OPEN, PENDING, RESOLVED).
- **`risk_zones`**: Stores circular zones defined by `lat`, `lng`, `radius`, and `risk_score`.
- **`live_incidents`**: Stores fleeting events like accidents or protests.

### 3. Real-Time Visualization (Frontend Dashboard)
- **Direct Connection**: `Dashboard.jsx` connects **directly** to Firestore using the Firebase Web SDK.
- **Live Listeners**:
  - `onSnapshot("emergency_logs")`: Listens for new SOS alerts.
  - **Live Session Mode**: Automatically filters out historical/test data on load. Only shows **new** alerts triggered while the dashboard is open.
  - `onSnapshot("risk_zones")`: Fetches and renders red circles on the map.
  - `onSnapshot("live_incidents")`: Updates incident markers.
- **Map Rendering**: Uses `react-leaflet` to render:
  - **Pulsing Red Markers**: Active SOS alerts.
  - **Red Circles**: High-risk zones (Risk Score > 0).
  - **Yellow Icons**: General incidents.

---

## ðŸ›  Recent Fixes & Improvements

### 1. Infrastructure Stability
- **Issue**: Backend files were scattered and referencing absolute paths outside the workspace.
- **Fix**: Consolidated backend into `c:\police portal\backend` and updated dependency references.
- **Result**: The project is now self-contained and easier to run on any machine with the key.

### 2. Credential Management
- **Issue**: `check_all_docs.py` was hardcoded to an old path.
- **Fix**: Updated to look for `backend\serviceAccountKey.json`.

---

## ðŸš€ How to Use
1. **Access the Portal**: Open [http://localhost:5173](http://localhost:5173).
2. **View Alerts**: Active SOS calls appear as pulsing red icons. Click them to see details (`Phone`, `Time`, `Location`).
3. **Manage Status**: Use the sidebar feed to **Acknowledge** or **Resolve** alerts.
4. **Monitor Risks**: Red circles indicate unsafe areas. The backend avoids routing users through these zones.

---

**Generated by Antigravity** | *2026-02-08*
